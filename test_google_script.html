<!DOCTYPE html>
<html>
<head>
    <title>Google Script 測試</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>Google Apps Script 測試頁面</h1>
    <button id="testBtn">測試連接</button>
    <div id="result" style="margin-top: 20px; padding: 10px; border: 1px solid #ddd;"></div>

    <script>
    document.getElementById('testBtn').addEventListener('click', function() {
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = "測試中...";
        
        // 使用您的 Google Apps Script URL
        const scriptURL = 'https://script.google.com/macros/s/AKfycbysY-Zsg-X7zFW99TF--KpxCgF5XfmWl9TWuNQ31eg3kqf5_kq4I16ofic8FOuhw2hUBg/exec';
        
        // 添加一個時間戳參數，避免快取問題
        const url = new URL(scriptURL);
        url.searchParams.append('test', 'true');
        url.searchParams.append('timestamp', new Date().getTime());
        
        fetch(url.toString(), {
            method: 'GET',
            mode: 'no-cors'
        })
        .then(() => {
            resultDiv.innerHTML += "<p style='color:green'>請求已發送，但因為 no-cors 模式無法讀取回應</p>";
            
            // 使用 CORS 代理再次嘗試，以讀取回應
            const corsProxyUrl = 'https://corsproxy.io/?' + encodeURIComponent(url.toString());
            return fetch(corsProxyUrl);
        })
        .then(response => response.text())
        .then(data => {
            resultDiv.innerHTML += `<p style='color:green'>成功! 代理回應: ${data}</p>`;
        })
        .catch(error => {
            resultDiv.innerHTML += `<p style='color:red'>錯誤: ${error.message}</p>`;
            
            // 提供其他排障信息
            resultDiv.innerHTML += "<p>排障步驟:</p>";
            resultDiv.innerHTML += "<ol>";
            resultDiv.innerHTML += "<li>確認 Google Apps Script 已部署為網頁應用程式</li>";
            resultDiv.innerHTML += "<li>確認存取權限設置為「任何人」</li>";
            resultDiv.innerHTML += "<li>檢查是否有 CORS 錯誤在瀏覽器控制台中</li>";
            resultDiv.innerHTML += "</ol>";
        });
    });
    </script>
</body>
</html>
